---
- name: Install and configure nftables
  block:

  - name: Install nftables from backports
    ansible.builtin.apt:
      name: nftables
      default_release: buster-backports
      state: latest
  
  - name: Copy nftables config file
    ansible.builtin.copy:
      src: nftables_router.conf
      dest: /etc/nftables.conf
      owner: root
      group: root
      mode: u=rw,g=,o=
      force: yes
    register: nftables_config_result

  - name: Restart nftables service
    ansible.builtin.service:
      name: nftables.service
      enabled: yes
      state: restarted
    when: nftables_config_result.changed | bool == true