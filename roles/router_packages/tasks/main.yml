---
- name: Installation of basic packages from buster-stable
  ansible.builtin.apt:
    name: "{{ stable_packages }}"
    state: present

- name: Installation of basic packages from buster-backports
  ansible.builtin.apt:
    name: "{{ backports_packages }}"
    default_release: buster-backports
    state: present

- name: Create .config folder for neovim
  ansible.builtin.file:
    path: /home/{{ primary_user_username }}/.config/nvim
    owner: emanon
    group: emanon
    mode: u=rwx,g=,o=
    state: directory

- name: Configure neovim
  ansible.builtin.copy:
    src: neovim_init.vim
    dest: /home/{{  primary_user_username }}/.config/nvim/init.vim
    owner: emanon
    group: emanon
    mode: u=rw,g=,o=

- name: Upgrade Kernel to "{{ kernel_version }}"
  ansible.builtin.apt:
    name:
          - linux-image-{{ kernel_version }}
          - linux-headers-{{ kernel_version }}
  when: kernel_upgrade
  notify: Reboot to apply Kernel upgrade

- name: Reboot to apply Kernel upgrade
  reboot:
    reboot_timeout: 300