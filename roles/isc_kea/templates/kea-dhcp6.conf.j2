{
  "Dhcp6": {
    "interfaces-config": {
      "interfaces": [
        "bond0/{{ grp_device.router.ipv6_addr }}"
      ]
    },
    "multi-threading": {
      "enable-multi-threading": true,
      "thread-pool-size": 4,
      "packet-queue-size": 28
    },
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "/tmp/kea6-ctrl-socket"
    },
    "hooks-libraries": [
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_stat_cmds.so"
      },
      {
        "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_lease_cmds.so"
      }
    ],
    "lease-database": {
      "type": "memfile",
      "persist": true,
      "name": "/var/lib/kea/dhcp6.leases",
      "lfc-interval": 3600
    },
    "loggers": [
      {
        "name": "kea-dhcp6",
        "output_options": [
          {
            "output": "/var/log/kea/kea-dhcp6.log",
            "pattern": {% raw %}"%D{%Y-%m-%d %H:%M:%S.%q} %-5p [%c/%i] %m\n",{% endraw %}

            "flush": false,
            "maxsize": 1048576,
            "maxver": 8
          }
        ],
        "severity": "INFO",
        "debuglevel": 0
      }
    ],
    "valid-lifetime": 4000,
    "renew-timer": 1000,
    "rebind-timer": 2000,
    "option-data": [
      {
        "name": "unicast",
        "data": "{{ grp_device.router.ipv6_addr }}"
      },
      {
        "name": "dns-servers",
        "data": "{% for dns_server in isc_kea_dns_ipv6_servers %}{{ dns_server }}{% if not loop.last %}, {% endif %}{% endfor %}"
      },
      {
        "name": "domain-search",
        "data": "{% for domain in isc_kea_domains_search %}{{ domain }}{% if not loop.last %}, {% endif %}{% endfor %}"
      },
      {
        "name": "sntp-servers",
        "data": "{% for ntp_server in isc_kea_ntp_ipv6_servers %}{{ ntp_server }}{% if not loop.last %}, {% endif %}{% endfor %}"
      }
    ],
    "host-reservation-identifiers": [
      "duid", "hw-address"
    ],
    "subnet6": [{% for subnet in host_isc_kea_dhcp6 %}
    
     {
        "subnet": "{{ subnet.subnet }}",
        "pools" : [{% for pool in subnet.pools %}  
          {
            "pool": "{{ pool.start }}-{{ pool.end }}"
          }{% if not loop.last %},{% endif %}{% endfor %}
      
        ],

        "reservations": [{% for reservation in subnet.reservations %}
          
          {
            "hw-address": "{{ reservation.hw_addr }}",
            "ip-addresses": ["{{ reservation.ipv6_addr }}"],
            "hostname": "{{ reservation.hostname }}"
          }{%if not loop.last %},{% endif %}{% endfor %}

        ]
      }{% if not loop.last %},{% endif %}{% endfor %}

    ]
  }
}

