---
- name: Install nfs client
  ansible.builtin.apt:
    name: nfs-common
    state: present

- name: Create nfs mount point
  ansible.builtin.file:
    path: "{{ nfs_mount_dir }}"
    owner: "{{ nfs_username }}"
    group: "{{ nfs_username }}"
    mode: u=rwx,g=,o=
    state: directory

- name: Check if service already exist
  ansible.builtin.stat:
    path: /etc/systemd/system/nfs-share.mount
  register: res

- name: Mount the share
  ansible.builtin.systemd:
    name: nfs-share.mount
    state: started
  when: res.stat.exists

- name: Configure nfs share
  ansible.builtin.template:
    src: mnt-vault.mount.j2
    dest: /etc/systemd/system/nfs-share.mount
    owner: root
    group: root
    mode: u=rw,g=r,o=r
  notify:
    - Daemon-reload nfs_share systemd
    - Enable nfs-share.mount service
    - Start nfs-share.mount service
    - Restart nfs-share.mount service