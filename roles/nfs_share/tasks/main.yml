---
- name: Install nfs client
  ansible.builtin.apt:
    name: nfs-common
    state: present

- name: Create nfs mount point
  ansible.builtin.file:
    path: "{{ grp_nfs_mount_dir }}"
    owner: "{{ primary_user_username }}"
    group: "{{ primary_user_username }}"
    mode: u=rwx,g=,o=
    state: directory

- name: Check if service already exist
  ansible.builtin.stat:
    path: /etc/systemd/system/{{ nfs_unit_name }}.mount
  register: res

- name: Mount the share
  ansible.builtin.systemd:
    name: "{{ nfs_unit_name }}.mount"
    state: started
  when: res.stat.exists

- name: Configure nfs share
  ansible.builtin.template:
    src: "{{ nfs_unit_name }}.mount.j2"
    dest: /etc/systemd/system/{{ nfs_unit_name }}.mount
    owner: root
    group: root
    mode: u=rw,g=r,o=r
  notify:
    - Daemon-reload nfs_share systemd
    - Enable {{ nfs_unit_name }}.mount service
    - Start {{ nfs_unit_name }}.mount service
    - Restart {{ nfs_unit_name }}.mount service